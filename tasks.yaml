# TODO: renovate setup
# yaml-language-server: $schema=https://raw.githubusercontent.com/defenseunicorns/uds-cli/v0.10.4/tasks.schema.json

includes:
  - create: ./tasks/create.yaml
  - deploy: ./tasks/deploy.yaml
  - publish: ./tasks/publish.yaml
  - create-core: https://raw.githubusercontent.com/defenseunicorns/uds-core/v0.19.0/tasks/create.yaml
  - deploy-core: https://raw.githubusercontent.com/defenseunicorns/uds-core/v0.19.0/tasks/deploy.yaml

tasks:
  - name: rke2-bootstrap-test
    description: "Complete a stand-up and stand-down of the ONLY the RKE2 cluster"
    actions:
      - task: create:temp-build-folder

      - task: create:uds-rke2
      - task: deploy:uds-rke2-bootstrap
        with:
          joinToken: "my-test-token"

      - task: deploy:uds-rke2-destroy

  - name: local-path-bootstrap
    description: "Bootstrap an RKE2 cluster, with Local Path Provisioner Zarf Init, MinIO, and UDS Core packages"
    actions:
      - task: create:temp-build-folder

      - task: create:uds-rke2
      - task: deploy:uds-rke2-bootstrap
        with:
          joinToken: "my-test-token"

      - task: create:local-path-init
      - task: deploy:local-path-init

      - task: create:minio
      - task: deploy:minio

      - task: deploy:specific-core-package-release

  - name: longhorn-bootstrap
    description: "Bootstrap an RKE2 cluster, with Longhorn Zarf Init, MinIO, and UDS Core packages"
    actions:
      - task: create:temp-build-folder

      - task: create:uds-rke2
      - task: deploy:uds-rke2-bootstrap
        with:
          joinToken: "my-test-token"

      - task: create:longhorn-init
      - task: deploy:longhorn-init

      - task: create:minio
      - task: deploy:minio

      - task: deploy:specific-core-package-release

  - name: rook-ceph-bootstrap
    description: "Bootstrap an RKE2 cluster, with Rook-Ceph Zarf Init and UDS Core packages"
    actions:
      - task: create:temp-build-folder

      - task: create:uds-rke2
      - task: deploy:uds-rke2-bootstrap
        with:
          joinToken: "my-test-token"

      - task: create:rook-ceph-init
      - task: deploy:rook-ceph-init

      - task: deploy:specific-core-package-release

  - name: create-all
    description: "Builds all Zarf packages in the repository"
    actions:
      - task: create:temp-build-folder
      - task: create:uds-rke2
      # TODO: add these back in when actually built
      # - task: create:local-path-init
      # - task: create:longhorn-init
      - task: create:rook-ceph-init
      - task: create:uds-rke2-exemptions
      - task: create:minio

  - name: publish-all
    description: "Builds all Zarf packages in the repository"
    actions:
      - task: publish:uds-rke2
      # TODO: add these back in when actually built
      # - task: publish:local-path-init
      # - task: publish:longhorn-init
      - task: publish:rook-ceph-init
      - task: publish:uds-rke2-exemptions
      - task: publish:minio